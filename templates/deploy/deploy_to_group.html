{% extends 'base/base.html' %}
{% block content %}
  <div class="container mt-4">
    <h2>Deploy to Group</h2>
    <form method="post" id="deploy-form">
      {% csrf_token %}
      <div class="form-group">
        <label for="playbook">Select Playbook:</label>
        <select class="form-control" id="playbook" name="playbook">
          {% for playbook in playbooks %}
            <option value="{{ playbook.id }}">{{ playbook.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="group">Select Group:</label>
        <select class="form-control" id="group" name="group">
          {% for group in groups %}
            <option value="{{ group.id }}">{{ group.name }}</option>
          {% endfor %}
        </select>
      </div>
      <button type="submit" class="btn btn-primary">Deploy</button>
    </form>
    <div id="progress-bar" style="display:none; text-align:center; margin-top:20px;">
      <div class="spinner-border text-primary" role="status">
        <span class="sr-only">Cargando...</span>
      </div>
      <p style="margin-top:10px;">Running playbook, please wait...</p>
    </div>
  </div>
  <script>
    // Mostrar spinner al enviar el formulario
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('deploy-form');
      if (form) {
        form.addEventListener('submit', function(e) {
          document.getElementById('progress-bar').style.display = 'block';
          e.preventDefault();
          setTimeout(() => form.submit(), 50);
        });
      }
    });
  </script>
{% endblock %}
